#!/bin/bash

#/ NAME
#/     usda -- runs test against meaty libraries using arbitrary arguments
#/
#/ SYNOPSIS
#/     usda one two three

shome="$(cd -P -- "$(dirname -- "$0")/.." && pwd -P)"
source "$shome/lib/_prime" "$@"

function gamut {
  "$shome/bin/meat" "$@"

  pushd "$shome/bin" > /dev/null
  ./meat "$@"
  popd > /dev/null

  pushd "$shome/lib" > /dev/null
  ../bin/meat "$@"
  popd > /dev/null

  meat "$@"
}

function main {
  gamut "$@"
  gamut --prime "$@"
}

parse_command_line "$@" || exit $?
eval set -- "${FLAGS_ARGV}"
main "$@" | sort | uniq -c
